# lab7: SSA

在HW6中，我们将程序转化成了Quad中间语言的形式，此时程序已经被线性化，表现为一条一条语句线性排列。本次作业我们将会引入Phi函数，通过Phi函数把Quad程序改写成SSA的形式。

# SSA(Static Single Assignment)

顾名思义，SSA形式的程序，一个变量可能会被多次使用，但一定只会被赋值一次。

在高级语言中，我们可以在程序的不同分支中，多次重复赋值某个变量$x$，但这样会不利于我们分析每次赋值的数据会流动到哪里。在SSA的形式下，这种程序会被改写，当不同的语句在赋值$x$的时候，它们赋值的目标会分别被改写成$x_1, x_2, \cdots$。但这带来了一个问题，考虑这样一种程序：

```python
if condition:
    x = 1
else:
    x = 2
print(x)
```

我们把程序改写成$x_1=1, x_2=2$，但却不知道最后打印的是哪一个变量。所以我们引入一个**假想**的phi函数$\phi(x_1,x_2)$，代表**自动判别**这里应该用什么$x$。所以改写成SSA的程序应该会变为这种形式：

```python
if condition:
    x1 = 1
else:
    x2 = 2
print(phi(x1,x2))
```

转化为SSA形式后，数据流动方向和冲突图等会变得更容易分析，从而让优化、分配寄存器等任务更加简单。实际上，我们并不需要关心phi函数是怎么实现的。在本次任务中，我们的目标只有一个，就是插入phi函数并重命名变量，使每个变量只被赋值一次。在之后的任务中，我们有其他手段消灭phi函数。

# 如何插入phi函数？

*请参考Week9的PPT

- 找到每个结点的Dominance Frontier
- 插入Phi函数
- 重命名变量

# lab7任务

你需要利用控制流图和数据流图（`domInfo`和`liveness`），修改`lib/quad/quadssa.cc`的各函数来实现quad转换到SSA的功能。